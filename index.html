<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>μ—°μ•  μ§‘μ°©λ„ ν…μ¤νΈ κ²°κ³Ό</title>
    <style>
        body { 
            font-family: "λ§‘μ€ κ³ λ”•", sans-serif; 
            padding: 2em; 
            max-width: 700px; 
            margin: auto; 
            background-color: #f5f5f5;
        }
        h1 { 
            color: #333366; 
            text-align: center;
        }
        .box { 
            border: 1px solid #ccc; 
            padding: 1.5em; 
            margin-top: 2em; 
            border-radius: 10px; 
            background-color: #f9f9f9; 
        }
        .result-box {
            background-color: #fff;
            padding: 2em;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .type-danger { color: #dc3545; }
        .type-warning { color: #ff6348; }
        .type-caution { color: #ffa500; }
        .type-stable { color: #28a745; }
        .scale-block { 
            margin-bottom: 1.2em; 
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 8px;
        }
        .high-score { 
            color: #dc3545; 
            font-weight: bold; 
        }
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .error {
            color: #dc3545;
            text-align: center;
            padding: 2em;
        }
    </style>
</head>
<body>
    <h1>π“‹ μ—°μ•  μ§‘μ°©λ„ ν…μ¤νΈ κ²°κ³Ό</h1>
    <div id="content"></div>

    <script>
        // URL νλΌλ―Έν„°μ—μ„ κ°’ κ°€μ Έμ¤κΈ°
        const urlParams = new URLSearchParams(window.location.search);
        
        // μ²™λ„λ³„ λ¬Έν•­ λ§¤ν•‘
        const scaleMapping = {
            'κ΄€κ³„μ§‘μ°©μ„±': [1, 6, 12, 18, 23, 27, 33, 36, 40, 43],
            'ν†µμ μ•κµ¬': [2, 7, 13, 19, 24, 28, 34, 37, 38, 41],
            'κ±°μ λ―Όκ°μ„±': [3, 8, 14, 20, 25, 29, 30, 35, 42, 44],
            'μκΈ°μ¤‘μ‹¬μ„±': [4, 9, 15, 21, 26],
            'μ—°μ• μ‹ λ…': [5, 10, 17, 32, 39]
        };

        // κ²°μ •λ¬Έν•­
        const criticalItems = [11, 22];

        // λ¬Έν•­ λ²νΈ λ§¤ν•‘ (μ£Όμμ κ²€ λ¬Έν•­ μ μ™Έ)
        const questionMapping = {
            1: 'q1', 2: 'q2', 3: 'q3', 4: 'q4', 5: 'q5',
            6: 'q6', 7: 'q7', 8: 'q8', 9: 'q9', 10: 'q10',
            11: 'q11', 12: 'q12', 13: 'q13', 14: 'q14', 15: 'q15',
            17: 'q16', 18: 'q17', 19: 'q18', 20: 'q19', 21: 'q20',
            22: 'q21', 23: 'q22', 24: 'q23', 25: 'q24', 26: 'q25',
            27: 'q26', 28: 'q27', 29: 'q28', 30: 'q29', 32: 'q30',
            33: 'q31', 34: 'q32', 35: 'q33', 36: 'q34', 37: 'q35',
            38: 'q36', 39: 'q37', 40: 'q38', 41: 'q39', 42: 'q40',
            43: 'q41', 44: 'q42'
        };

        function calculateResult() {
            // λ¨λ“  λ¬Έν•­μ΄ μλ”μ§€ ν™•μΈ
            let allAnswered = true;
            for (let i = 1; i <= 42; i++) {
                if (!urlParams.get(`q${i}`)) {
                    allAnswered = false;
                    break;
                }
            }

            if (!allAnswered) {
                document.getElementById('content').innerHTML = 
                    '<div class="error">λ¨λ“  λ¬Έν•­μ— λ‹µλ³€μ΄ ν•„μ”ν•©λ‹λ‹¤. κ²€μ‚¬λ¥Ό λ‹¤μ‹ μ§„ν–‰ν•΄μ£Όμ„Έμ”.</div>';
                return;
            }

            // μ²™λ„λ³„ μ μ κ³„μ‚°
            const scores = {};
            let totalScore = 0;
            
            for (const [scale, items] of Object.entries(scaleMapping)) {
                let scaleSum = 0;
                for (const item of items) {
                    const paramName = questionMapping[item];
                    const value = parseInt(urlParams.get(paramName) || '0');
                    scaleSum += value;
                }
                scores[scale] = (scaleSum / items.length).toFixed(1);
                totalScore += scaleSum;
            }

            // κ²°μ •λ¬Έν•­ μ²΄ν¬
            let criticalChecked = false;
            for (const item of criticalItems) {
                const paramName = questionMapping[item];
                const value = parseInt(urlParams.get(paramName) || '0');
                if (value >= 4) {
                    criticalChecked = true;
                    break;
                }
            }

            // μ ν• νμ •
            const avgScore = totalScore / 40;
            let type = '';
            let typeClass = '';

            if (criticalChecked && avgScore >= 3.0) {
                type = 'π”΄ μ„ν—ν•';
                typeClass = 'type-danger';
            } else if (criticalChecked && avgScore < 3.0) {
                type = 'π  κ²½κ³„ν•';
                typeClass = 'type-warning';
            } else if (!criticalChecked && avgScore >= 2.8) {
                type = 'π΅ μ£Όμν•';
                typeClass = 'type-caution';
            } else {
                type = 'πΆ μ•μ •ν•';
                typeClass = 'type-stable';
            }

            // κ²°κ³Ό HTML μƒμ„±
            let html = '<div class="result-box">';
            html += `<p>κ²€μ‚¬ κ²°κ³Όλ” <span class="${typeClass}" style="font-weight: bold; font-size: 1.2em;">${type}</span>μ…λ‹λ‹¤.</p>`;
            html += `<p>μ΄μ : <strong>${totalScore}μ  / 210μ </strong></p>`;
            
            html += '<hr style="margin: 20px 0;">';
            html += '<h3>π“ ν•μ„ μ²™λ„ μ”μ•½</h3>';
            
            let hasHighScore = false;
            let highScales = [];

            for (const [scale, score] of Object.entries(scores)) {
                const scoreFloat = parseFloat(score);
                let level = '';
                let scoreClass = '';
                
                if (scoreFloat >= 4.0) {
                    level = 'λ†’μ';
                    scoreClass = 'high-score';
                    hasHighScore = true;
                    highScales.push(scale);
                } else if (scoreFloat >= 2.5) {
                    level = 'λ³΄ν†µ';
                } else {
                    level = 'λ‚®μ';
                }
                
                let scaleDesc = '';
                switch(scale) {
                    case 'κ΄€κ³„μ§‘μ°©μ„±':
                        scaleDesc = 'μƒλ€λ°©μ— λ€ν• κ³Όλ„ν• κ΄€μ‹¬κ³Ό ν™•μΈ μ•κµ¬λ¥Ό λ‹¤λ£¨λ” μ²™λ„μ…λ‹λ‹¤.';
                        break;
                    case 'ν†µμ μ•κµ¬':
                        scaleDesc = 'μƒλ€λ°©μ μΌμ •, ν–‰λ™, κ΄€κ³„λ¥Ό μ΅°μ¨ν•λ ¤λ” κ²½ν–¥μ…λ‹λ‹¤.';
                        break;
                    case 'κ±°μ λ―Όκ°μ„±':
                        scaleDesc = 'κ±°μ μ΄λ‚ λ¬΄μ‹μ— λ€ν• μ •μ„μ  λ°μ‘ λ―Όκ°λ„λ¥Ό μΈ΅μ •ν•©λ‹λ‹¤.';
                        break;
                    case 'μκΈ°μ¤‘μ‹¬μ„±':
                        scaleDesc = 'μ—°μ• μ—μ„ μμ‹ μ μ‹κ°μ΄λ‚ κ°μ •μ— μ§‘μ¤‘ν•λ” κ²½ν–¥μ…λ‹λ‹¤.';
                        break;
                    case 'μ—°μ• μ‹ λ…':
                        scaleDesc = 'μ—°μ• μ— λ€ν• κ³ μ •κ΄€λ… λλ” μ΄μƒν™” κ²½ν–¥μ„ μΈ΅μ •ν•©λ‹λ‹¤.';
                        break;
                }
                
                html += `<div class="scale-block">`;
                html += `<strong>${scale}</strong> (<span class="${scoreClass}">${score}μ </span>, ${level}): ${scaleDesc}`;
                html += `</div>`;
            }

            // κ²½κ³  λ©”μ‹μ§€
            if (hasHighScore) {
                html += `<div class="warning">`;
                html += `β οΈ <strong>μ£Όμ:</strong> μΌλ¶€ μ²™λ„(${highScales.join(', ')})μ—μ„ λ†’μ€ λ°μ‘μ΄ ν™•μΈλμ—μµλ‹λ‹¤. `;
                html += `ν•΄λ‹Ή μμ—­μ—μ„μ κ°μ • κ΄€λ¦¬λ‚ κ΄€κ³„ λ°©μ‹μ— μ£Όμκ°€ ν•„μ”ν•©λ‹λ‹¤.`;
                html += `</div>`;
            }

            html += '<hr style="margin: 20px 0;">';
            html += '<p>β οΈ μƒμ„Έ ν•΄μ„κ³Ό λ§μ¶¤ μ΅°μ–Έμ€ μ΄λ©”μΌ μ…λ ¥μμ— ν•ν•΄ κ°λ³„ λ°μ†΅λ©λ‹λ‹¤.</p>';
            html += '<p>κ²°κ³Ό λ¦¬ν¬νΈλ¥Ό λ‹¤μ‹ λ°›κ³  μ‹¶μΌμ‹λ©΄ κ²€μ‚¬ λ§μ§€λ§‰ νμ΄μ§€μ—μ„ μ΄λ©”μΌμ„ μ…λ ¥ν•΄μ£Όμ„Έμ”.</p>';
            html += '</div>';

            document.getElementById('content').innerHTML = html;
        }

        // νμ΄μ§€ λ΅λ“ μ‹ μλ™ μ‹¤ν–‰
        window.onload = function() {
            calculateResult();
        };
    </script>
</body>
</html>
